# 科研人员匹配
综述：用户在检索框输入检索文本[query],后台返回一个json,包含10个按匹配程序排序教师`id`和专利`id`.
计划：
- 先完成基于tf-idf模型的匹配
- 后期探索基于深度模型的匹配

## Usage
**第一次使用**先基于数据库数据训练模型,运行`python tf_idf_model.py`,会在`/data`目录下生成`data/teachers.mm`,`data/teachers.dict`,`data/teachers.index`.三个模型数据和一个`data/t_pat_dict.json`字典数据.

**模型生成后**调用匹配模型时,先初始化`Similarity`类,它会加载模型和必要的文件,然后每次搜索时调用`send_query`方法,他会返回一个`json`,它一共有两个键值,第一个是{'teacher_results':前10个教师的编号和该教师最相关的专利编号},第二个元素是{'pat_results':前10个专利的编号}.
示例如下:
```
>>>from tf_idf_model import Similarity
>>>s=Similarity()
>>>s.send_query('人工智能')

return:
{"teacher_results": {"0": ["72", "11527"], "1": ["909", "5500"], "2": ["1646", "12290"], "3": ["208", "8299"], "4": ["948", "12072"], "5": ["6", "16942"], "6": ["1474", "10393"], "7": ["613", "16876"], "8": ["881", "12072"], "9": ["1435", "15138"]}, "pat_results": {"0": "16942", "1": "46627", "2": "11527", "3": "35425", "4": "15707", "5": "46214", "6": "11841", "7": "35429", "8": "11841", "9": "35429"}}

# [['975', '7667'],...]表示编号为'975'的教师最匹配，且该老师编号为'7667'的专利最相关;['13676',...]表示编号'13676'的专利与query最相关

```



## 数据处理
### 数据来源
数据来源主要考虑本地和数据库两种,本地数据可以直接用pandas进行读取,数据数据，在取得连接后，也可以用pd.read_sql连接.  

数据的输入包括:
- 教师的信息，包括学院，研究方向，专利和论文的信息.
- 专利信息全文
- 教师信息和专利信息的关联表
- query文本

### 数据预处理

数据的预处理包括，[分词，去停用词，去掉低频词，构建语料库]等任务。  
对于tf-idf模型来说，还要预先生成corpus,dictionary,index等模型文件.
这样在预测阶段，就可以使用dictionary去数值化query文本,使用index去计算相似度.

## 模型准备
1. `gen_documents`接受来自不同数据源的数据,返回结果给`create_corpus`
2. `create_corpus`函数接收一个包含所有文本的列表，将生成的`corpus`和`dictionary`保存下来`data/teachers.mm`,`data/teachers.dict`
3. `create_index`函数使用`TfidfModel`模型构建相似度检索文件并保存`data/teachers.index`.

## 项目结构
项目的主要结构在`Similarity`中，初始化从本地读取模型和字典到内存中去,然后传进`query`文本, 再对`query`文本解析后,遍历一遍所有教师的信息，计算每个教师每一个特征与`query`的相似度，最后相加得出每个教师的总相似度度,最后返回前10个教师的id和最靠前属性的的id

## 上线测试

## 模型评估

